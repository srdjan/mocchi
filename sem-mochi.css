/**
 * sem-mochi.css - Semantic-First CSS Framework with Minimal Class Usage
 * v1.0.0
 * A type-safe, functional approach to CSS with direct element targeting
 * MIT License
 */

/* ---- CSS Architecture with Cascade Layers ---- */
@layer tokens, base, elements, composition, states, queries;

/* ---- Design Tokens Layer ---- */
@layer tokens {
  :root {
    /* Color Tokens - Primary Source */
    --sm-color-blue-50: #eff6ff;
    --sm-color-blue-100: #dbeafe;
    --sm-color-blue-500: #3b82f6;
    --sm-color-blue-600: #2563eb;
    --sm-color-blue-700: #1d4ed8;

    --sm-color-green-50: #ecfdf5;
    --sm-color-green-500: #10b981;
    --sm-color-green-600: #059669;

    --sm-color-yellow-50: #fffbeb;
    --sm-color-yellow-500: #f59e0b;
    --sm-color-yellow-600: #d97706;

    --sm-color-red-50: #fef2f2;
    --sm-color-red-500: #ef4444;
    --sm-color-red-600: #dc2626;

    --sm-color-gray-50: #f9fafb;
    --sm-color-gray-100: #f3f4f6;
    --sm-color-gray-200: #e5e7eb;
    --sm-color-gray-300: #d1d5db;
    --sm-color-gray-400: #9ca3af;
    --sm-color-gray-500: #6b7280;
    --sm-color-gray-600: #4b5563;
    --sm-color-gray-700: #374151;
    --sm-color-gray-800: #1f2937;
    --sm-color-gray-900: #111827;

    /* Semantic Tokens */
    --sm-bg: #ffffff;
    --sm-fg: var(--sm-color-gray-900);
    --sm-subtle: var(--sm-color-gray-600);
    --sm-accent: var(--sm-color-blue-500);
    --sm-accent-subtle: var(--sm-color-blue-600);
    --sm-success: var(--sm-color-green-500);
    --sm-warning: var(--sm-color-yellow-500);
    --sm-error: var(--sm-color-red-500);
    --sm-muted: var(--sm-color-gray-400);

    /* Border and UI Element Tokens */
    --sm-border: var(--sm-color-gray-200);
    --sm-input-bg: var(--sm-color-gray-50);
    --sm-focus-ring: color-mix(in srgb, var(--sm-accent) 50%, transparent);

    /* Fluid Typography Configuration */
    --sm-font-base-size: 1rem;
    /* 16px base font size */
    --sm-min-width: 20rem;
    /* 320px - minimum viewport width */
    --sm-max-width: 80rem;
    /* 1280px - maximum viewport width */
    --sm-min-scale: 0.875;
    /* minimum scale factor (14px) */
    --sm-max-scale: 1.125;
    /* maximum scale factor (18px) */

    /* Fluid Typography Formula Variables */
    --sm-slope: calc((var(--sm-max-scale) - var(--sm-min-scale)) / (var(--sm-max-width) - var(--sm-min-width)));
    --sm-slope-vw: calc(var(--sm-slope) * 100vw);
    --sm-intercept: calc(var(--sm-min-scale) - (var(--sm-slope) * var(--sm-min-width)));

    /* Fluid Size Computation for Base Font */
    --sm-fluid-factor: calc(var(--sm-slope-vw) + var(--sm-intercept));
    --sm-fluid-base: clamp(calc(var(--sm-min-scale) * var(--sm-font-base-size)),
        calc(var(--sm-fluid-factor) * var(--sm-font-base-size)),
        calc(var(--sm-max-scale) * var(--sm-font-base-size)));

    /* Type Scale - Minor Third (1.2) ratio */
    --sm-scale-ratio: 1.2;

    /* Fluid Type Scale using consistent ratio */
    --sm-font-xs: calc(var(--sm-fluid-base) / var(--sm-scale-ratio) / var(--sm-scale-ratio));
    --sm-font-sm: calc(var(--sm-fluid-base) / var(--sm-scale-ratio));
    --sm-font-base: var(--sm-fluid-base);
    --sm-font-md: calc(var(--sm-fluid-base) * var(--sm-scale-ratio));
    --sm-font-lg: calc(var(--sm-fluid-base) * var(--sm-scale-ratio) * var(--sm-scale-ratio));
    --sm-font-xl: calc(var(--sm-fluid-base) * var(--sm-scale-ratio) * var(--sm-scale-ratio) * var(--sm-scale-ratio));
    --sm-font-2xl: calc(var(--sm-fluid-base) * var(--sm-scale-ratio) * var(--sm-scale-ratio) * var(--sm-scale-ratio) * var(--sm-scale-ratio));
    --sm-font-3xl: calc(var(--sm-fluid-base) * var(--sm-scale-ratio) * var(--sm-scale-ratio) * var(--sm-scale-ratio) * var(--sm-scale-ratio) * var(--sm-scale-ratio));

    /* Line Height Scale - adjusts with font size */
    --sm-line-height-xs: 1.6;
    /* Larger line height for smaller text */
    --sm-line-height-sm: 1.5;
    --sm-line-height-base: 1.5;
    --sm-line-height-md: 1.4;
    --sm-line-height-lg: 1.3;
    --sm-line-height-xl: 1.2;
    --sm-line-height-2xl: 1.1;
    --sm-line-height-3xl: 1.1;

    /* Font Weights */
    --sm-weight-normal: 400;
    --sm-weight-medium: 500;
    --sm-weight-semibold: 600;
    --sm-weight-bold: 700;

    /* Letter Spacing - tighter for headings, looser for small text */
    --sm-letter-spacing-tight: -0.025em;
    --sm-letter-spacing-normal: 0;
    --sm-letter-spacing-wide: 0.025em;

    /* Measure (optimal line length) */
    --sm-measure: 70ch;
    --sm-measure-narrow: 60ch;
    --sm-measure-wide: 80ch;

    /* Typography */
    --sm-font-sans: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    --sm-font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;

    /* Space Scale */
    --sm-space-xs: clamp(0.25rem, 0.2rem + 0.25vw, 0.375rem);
    --sm-space-sm: clamp(0.5rem, 0.45rem + 0.25vw, 0.625rem);
    --sm-space: clamp(1rem, 0.9rem + 0.5vw, 1.25rem);
    --sm-space-md: clamp(1.5rem, 1.35rem + 0.75vw, 1.875rem);
    --sm-space-lg: clamp(2rem, 1.8rem + 1vw, 2.5rem);
    --sm-space-xl: clamp(3rem, 2.7rem + 1.5vw, 3.75rem);

    /* Radius Scale */
    --sm-radius-sm: 0.25rem;
    --sm-radius: 0.375rem;
    --sm-radius-md: 0.5rem;
    --sm-radius-lg: 0.75rem;

    /* Shadow Scale */
    --sm-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --sm-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
    --sm-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --sm-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

    /* Animation Tokens */
    --sm-transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --sm-transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);

    /* Container Breakpoints */
    --sm-narrow: 320px;
    --sm-medium: 768px;
    --sm-wide: 1024px;
  }
}

/* Dark mode using prefers-color-scheme */
@media (prefers-color-scheme: dark) {
  :root {
    --sm-bg: var(--sm-color-gray-800);
    --sm-fg: var(--sm-color-gray-50);
    --sm-subtle: var(--sm-color-gray-400);
    --sm-border: var(--sm-color-gray-700);
    --sm-input-bg: var(--sm-color-gray-900);
    --sm-focus-ring: color-mix(in srgb, var(--sm-accent) 60%, transparent);
  }
}

/* ---- Base Element Styling Layer ---- */
@layer base {

  /* Base HTML Reset */
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  /* Document base */
  html {
    font-family: var(--sm-font-sans);
    font-size: 100%;
    line-height: var(--sm-line-height-base);
    color: var(--sm-fg);
    background-color: var(--sm-bg);
    -webkit-text-size-adjust: 100%;
    scroll-behavior: smooth;
    font-synthesis: none;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  body {
    font-size: var(--sm-font-base);
    min-height: 100vh;
    max-width: 100vw;
    overflow-x: hidden;
  }

  /* Fix line height in all browsers */
  html,
  input,
  button,
  textarea,
  select {
    line-height: 1.15;
  }
}

/* ---- Semantic Elements Layer ---- */
@layer elements {
  /* ---- Layout Elements ---- */

  /* Main Container */
  main {
    display: block;
    width: min(100%, var(--sm-wide));
    margin-inline: auto;
    padding-block: var(--sm-space-md);
    padding-inline: var(--sm-space);
  }

  /* Header */
  header {
    padding-block: var(--sm-space);
    padding-inline: var(--sm-space);
    border-bottom: 1px solid var(--sm-border);
    background-color: var(--sm-bg);
  }

  /* Sticky Header */
  header[sticky] {
    position: sticky;
    top: 0;
    z-index: 10;
  }

  /* Enhanced Navigation */
  nav {
    --nav-gap: var(--sm-space-sm);
    --nav-padding-block: 0.625rem;
    --nav-padding-inline: var(--sm-space);
    --nav-border-width: 2px;

    display: flex;
    flex-wrap: wrap;
    gap: var(--nav-gap);
    padding-block: var(--nav-padding-block);
    padding-inline: var(--nav-padding-inline);
    background-color: var(--sm-input-bg);
    border-bottom: 1px solid var(--sm-border);
    position: relative;
  }

  /* Primary Site Navigation */
  nav[role="navigation"],
  nav.primary {
    background-color: var(--sm-input-bg);
    box-shadow: 0 1px 0 var(--sm-border);
  }

  /* Navigation Links */
  nav a {
    position: relative;
    display: inline-flex;
    align-items: center;
    padding-block: 0.5rem;
    padding-inline: 0.75rem;
    color: var(--sm-fg);
    text-decoration: none;
    border-radius: var(--sm-radius-sm);
    transition:
      color var(--sm-transition-fast),
      background-color var(--sm-transition-fast);

    /* Link hover effect */
    &:hover {
      color: var(--sm-accent);
      background-color: color-mix(in srgb, var(--sm-accent) 5%, transparent);
      text-decoration: none;
    }

    /* Link focus effect */
    &:focus-visible {
      outline: none;
      box-shadow: 0 0 0 2px var(--sm-focus-ring);
    }

    /* Current page indicator - underline */
    &[aria-current="page"] {
      font-weight: var(--sm-weight-medium);
      color: var(--sm-accent);

      &::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0.75rem;
        right: 0.75rem;
        height: var(--nav-border-width);
        background-color: var(--sm-accent);
        border-radius: var(--nav-border-width);
      }
    }

    /* Icon support in navigation */
    & svg {
      width: 1.25em;
      height: 1.25em;
      margin-inline-end: 0.25em;
    }
  }

  /* Navigation Groups */
  nav>div,
  nav>ul {
    display: flex;
    flex-wrap: wrap;
    gap: var(--nav-gap);
    align-items: center;
  }

  /* Navigation List - Reset list styling */
  nav>ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  /* Space between navigation groups */
  nav> :not(:first-child) {
    margin-inline-start: auto;
  }

  /* Sticky navigation */
  nav[sticky] {
    position: sticky;
    top: 0;
    z-index: 10;
    backdrop-filter: blur(8px);
    background-color: color-mix(in srgb, var(--sm-input-bg) 90%, transparent);
  }

  /* Horizontal line dividing navigation sections */
  nav hr {
    height: 1.5rem;
    width: 1px;
    margin: 0;
    border: none;
    background-color: var(--sm-border);
  }

  /* Compact navigation variant */
  nav[compact] {
    --nav-padding-block: 0.25rem;
    --nav-gap: 0.25rem;

    & a {
      padding-block: 0.25rem;
      padding-inline: 0.5rem;
      font-size: var(--sm-font-sm);
    }
  }

  /* Tabs-style navigation variant */
  nav[tabs] {
    --nav-border-width: 3px;

    & a {
      padding-inline: 1rem;
      border-bottom: var(--nav-border-width) solid transparent;

      &[aria-current="page"] {
        border-bottom-color: var(--sm-accent);

        &::after {
          content: none;
        }
      }
    }
  }

  /* Pills-style navigation variant */
  nav[pills] a {
    border-radius: 9999px;
    padding-inline: 1rem;

    &[aria-current="page"] {
      color: white;
      background-color: var(--sm-accent);

      &::after {
        content: none;
      }
    }
  }

  /* Mobile navigation toggle */
  nav .nav-toggle {
    display: none;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    padding: 0;
    background-color: transparent;
    border: none;
    cursor: pointer;
  }

  /* Hamburger icon */
  nav .nav-toggle::before {
    content: "";
    display: block;
    width: 1.5rem;
    height: 2px;
    background-color: var(--sm-fg);
    position: relative;
    transition: transform var(--sm-transition-fast);

    &::before,
    &::after {
      content: "";
      display: block;
      width: 1.5rem;
      height: 2px;
      background-color: var(--sm-fg);
      position: absolute;
      transition: transform var(--sm-transition-fast);
    }

    &::before {
      top: -6px;
    }

    &::after {
      bottom: -6px;
    }
  }

  /* Responsive navigation */
  @media (max-width: 767px) {
    nav[collapsible] {
      flex-wrap: wrap;

      & .nav-toggle {
        display: flex;
        margin-inline-start: auto;
      }

      &>ul,
      &>div:not(:first-child) {
        display: none;
        width: 100%;
        flex-direction: column;
        align-items: stretch;

        & a {
          width: 100%;
        }
      }

      &[expanded]>ul,
      &[expanded]>div:not(:first-child) {
        display: flex;
      }

      &[expanded] .nav-toggle::before {
        transform: rotate(45deg);

        &::before {
          transform: rotate(90deg);
          top: 0;
        }

        &::after {
          transform: rotate(90deg);
          bottom: 0;
        }
      }
    }
  }

  /* Footer */
  footer {
    padding-block: var(--sm-space-lg);
    padding-inline: var(--sm-space);
    border-top: 1px solid var(--sm-border);
    background-color: var(--sm-input-bg);
    color: var(--sm-subtle);
    text-align: center;
  }

  /* Section */
  section {
    margin-block-end: var(--sm-space-xl);
  }

  /* Article */
  article {
    max-width: 65ch;
    margin-inline: auto;
  }

  /* Aside */
  aside {
    padding: var(--sm-space);
    border-radius: var(--sm-radius);
    background-color: var(--sm-input-bg);
  }

  /* ---- Typography Elements ---- */

  /* Headings */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin-block-start: 0;
    margin-block-end: var(--sm-space);
    font-weight: var(--sm-weight-semibold);
    line-height: 1.2;
    color: var(--sm-fg);
    letter-spacing: var(--sm-letter-spacing-tight);
    max-width: var(--sm-measure);
  }

  h1 {
    font-size: var(--sm-font-3xl);
    line-height: var(--sm-line-height-3xl);
    margin-block-end: calc(var(--sm-space) * 1.5);
  }

  h2 {
    font-size: var(--sm-font-2xl);
    line-height: var(--sm-line-height-2xl);
    border-bottom: 1px solid var(--sm-border);
    padding-bottom: var(--sm-space-xs);
    margin-block-end: calc(var(--sm-space) * 1.2);
  }

  h3 {
    font-size: var(--sm-font-xl);
    line-height: var(--sm-line-height-xl);
    margin-block-end: var(--sm-space);
  }

  h4 {
    font-size: var(--sm-font-lg);
    line-height: var(--sm-line-height-lg);
  }

  h5 {
    font-size: var(--sm-font-md);
    line-height: var(--sm-line-height-md);
  }

  h6 {
    font-size: var(--sm-font-base);
    line-height: var(--sm-line-height-base);
    color: var(--sm-subtle);
  }

  /* Paragraphs */
  p {
    margin-block-end: var(--sm-space);
    max-width: var(--sm-measure);
    line-height: var(--sm-line-height-base);
  }

  /* Links */
  a {
    color: var(--sm-accent);
    text-decoration: none;
    text-decoration-thickness: 1px;
    text-underline-offset: 0.15em;
    transition: color var(--sm-transition-fast);

    &:hover {
      color: var(--sm-accent-subtle);
      text-decoration: underline;
      text-decoration-thickness: 2px;
    }

    &:focus-visible {
      outline: 2px solid var(--sm-focus-ring);
      outline-offset: 2px;
      border-radius: var(--sm-radius-sm);
    }
  }

  /* Inline elements */
  strong,
  b {
    font-weight: var(--sm-weight-semibold);
  }

  em,
  i {
    font-style: italic;
  }

  /* Code, Pre, Kbd */
  code,
  pre,
  kbd {
    font-family: var(--sm-font-mono);
    font-size: 0.9em;
  }

  code {
    background-color: var(--sm-input-bg);
    padding-block: 0.2em;
    padding-inline: 0.4em;
    border-radius: var(--sm-radius-sm);
  }

  pre {
    margin-block: var(--sm-space);
    padding: var(--sm-space);
    overflow: auto;
    background-color: var(--sm-input-bg);
    border-radius: var(--sm-radius);

    & code {
      background-color: transparent;
      padding: 0;
      font-size: inherit;
    }
  }

  kbd {
    background-color: var(--sm-input-bg);
    border: 1px solid var(--sm-border);
    border-radius: var(--sm-radius-sm);
    box-shadow: 0 1px 0 var(--sm-border);
    padding-block: 0.1em;
    padding-inline: 0.4em;
  }

  /* Lists */
  ul,
  ol {
    margin-block-start: 0;
    margin-block-end: var(--sm-space);
    padding-inline-start: 1.5em;
    max-width: var(--sm-measure);
  }

  li {
    margin-block-end: calc(var(--sm-space) * 0.5);
    line-height: var(--sm-line-height-base);
  }

  /* Description Lists */
  dl {
    margin-block-end: var(--sm-space);
    max-width: var(--sm-measure);
  }

  dt {
    font-weight: 600;
    margin-block-start: var(--sm-space-sm);
  }

  dd {
    margin-inline-start: var(--sm-space);
    margin-block-end: var(--sm-space-xs);
  }

  /* Blockquote */
  blockquote {
    margin-block: var(--sm-space);
    padding-block: var(--sm-space);
    padding-inline: var(--sm-space);
    border-inline-start: 4px solid var(--sm-accent);
    background-color: var(--sm-input-bg);
    border-radius: var(--sm-radius);
    font-style: italic;
    max-width: var(--sm-measure-narrow);
  }

  blockquote>* {
    margin-block-end: 0;
  }

  blockquote cite {
    display: block;
    margin-top: var(--sm-space-sm);
    font-size: var(--sm-font-sm);
    font-style: normal;
    color: var(--sm-subtle);
  }

  /* Horizontal rule */
  hr {
    height: 0;
    margin-block: var(--sm-space-lg);
    border: 0;
    border-top: 1px solid var(--sm-border);
  }

  /* Small text */
  small {
    font-size: var(--sm-font-sm);
    line-height: var(--sm-line-height-sm);
    letter-spacing: var(--sm-letter-spacing-wide);
  }

  /* Text selection */
  ::selection {
    background-color: color-mix(in srgb, var(--sm-accent) 40%, transparent);
    color: var(--sm-fg);
  }

  /* Focus visible for keyboard navigation */
  :focus-visible {
    outline: 2px solid var(--sm-focus-ring);
    outline-offset: 2px;
  }

  /* ---- Form Elements ---- */

  /* Form element base */
  input,
  textarea,
  select,
  button {
    font-family: inherit;
    font-size: 100%;
    padding-block: 0.5rem;
    padding-inline: 0.75rem;
    background-color: var(--sm-input-bg);
    border: 1px solid var(--sm-border);
    border-radius: var(--sm-radius);
    transition: border-color var(--sm-transition-fast), box-shadow var(--sm-transition-fast);
  }

  /* Text inputs, textareas, and selects */
  input:not([type="checkbox"]):not([type="radio"]):not([type="submit"]):not([type="button"]),
  textarea,
  select {
    display: block;
    width: 100%;
    color: var(--sm-fg);

    &:focus {
      outline: 0;
      border-color: var(--sm-accent);
      box-shadow: 0 0 0 3px var(--sm-focus-ring);
    }

    &:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      background-color: color-mix(in srgb, var(--sm-input-bg) 80%, var(--sm-border));
    }
  }

  /* Form validation - errors */
  input:invalid:not(:placeholder-shown),
  textarea:invalid:not(:placeholder-shown),
  select:invalid:not(:placeholder-shown) {
    border-color: var(--sm-error);

    &:focus {
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--sm-error) 30%, transparent);
    }
  }

  /* Valid state */
  input:valid:not(:placeholder-shown),
  textarea:valid:not(:placeholder-shown),
  select:valid:not(:placeholder-shown) {
    border-color: var(--sm-success);
  }

  /* Placeholders */
  ::placeholder {
    color: var(--sm-muted);
  }

  /* Buttons */
  button,
  input[type="submit"],
  input[type="button"] {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5em;
    font-weight: 500;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
    user-select: none;
    border: 1px solid var(--sm-border);
    transition:
      color var(--sm-transition-fast),
      background-color var(--sm-transition-fast),
      border-color var(--sm-transition-fast),
      box-shadow var(--sm-transition-fast);

    &:hover {
      background-color: var(--sm-input-bg);
    }

    &:active {
      background-color: var(--sm-border);
    }

    &:focus-visible {
      outline: 0;
      box-shadow: 0 0 0 3px var(--sm-focus-ring);
    }

    &:disabled {
      opacity: 0.65;
      cursor: not-allowed;
    }
  }

  /* Icon in button */
  button svg,
  input[type="submit"] svg,
  input[type="button"] svg {
    width: 1em;
    height: 1em;
  }

  /* Checkboxes and radios */
  input[type="checkbox"],
  input[type="radio"] {
    margin-inline-end: 0.5rem;
  }

  /* Field grouping */
  fieldset {
    margin-block-end: var(--sm-space);
    padding: var(--sm-space);
    border: 1px solid var(--sm-border);
    border-radius: var(--sm-radius);
  }

  legend {
    padding-inline: 0.5em;
    font-weight: 600;
  }

/* Labels */
label {
  display: block;
  margin-block-end: 0.5rem;
  font-weight: 500;
  color: var(--sm-subtle);
}

/* Required fields */
label:has(+ [required])::after {
  content: " *";
  color: var(--sm-error);
}

/* Form groups */
form>*+* {
  margin-block-start: var(--sm-space);
}

/* ---- Table Elements ---- */

table {
  width: 100%;
  margin-block-end: var(--sm-space);
  border-collapse: collapse;
  border-spacing: 0;
}

th,
td {
  padding-block: 0.75rem;
  padding-inline: 0.75rem;
  text-align: start;
  border-bottom: 1px solid var(--sm-border);
}

th {
  font-weight: 600;
  background-color: var(--sm-input-bg);
}

tr:hover {
  background-color: color-mix(in srgb, var(--sm-input-bg) 50%, transparent);
}

/* Table caption */
caption {
  margin-block-end: var(--sm-space-sm);
  font-style: italic;
  text-align: start;
  color: var(--sm-subtle);
}

/* ---- Media Elements ---- */

img,
svg,
video,
canvas,
audio,
iframe,
embed,
object {
  display: block;
  max-width: 100%;
  height: auto;
}

figure {
  margin-block-end: var(--sm-space);
}

figcaption {
  margin-block-start: var(--sm-space-xs);
  color: var(--sm-subtle);
  font-size: var(--sm-font-sm);
  line-height: var(--sm-line-height-sm);
}

/* ---- Interactive Elements ---- */

/* Dialog/Modal */
dialog {
  padding: 0;
  border: 1px solid var(--sm-border);
  border-radius: var(--sm-radius-md);
  box-shadow: var(--sm-shadow-lg);
  background-color: var(--sm-bg);
  max-width: min(32rem, 90vw);
  width: 100%;
  margin: auto;
  color: var(--sm-fg);

  &::backdrop {
    background-color: color-mix(in srgb, black 50%, transparent);
    backdrop-filter: blur(2px);
  }
}

dialog>header {
  padding: var(--sm-space);
  border-bottom: 1px solid var(--sm-border);
  display: flex;
  align-items: center;
  justify-content: space-between;

  & h1,
  & h2,
  & h3,
  & h4,
  & h5,
  & h6 {
    margin: 0;
  }
}

dialog>.content,
dialog>form {
  padding: var(--sm-space);
}

dialog>footer {
  padding: var(--sm-space);
  border-top: 1px solid var(--sm-border);
  background-color: var(--sm-input-bg);
  display: flex;
  justify-content: flex-end;
  gap: var(--sm-space-sm);
  text-align: right;
}

/* Details & Summary */
details {
  margin-block-end: var(--sm-space);
  border: 1px solid var(--sm-border);
  border-radius: var(--sm-radius);
  overflow: hidden;
}

summary {
  padding: var(--sm-space);
  font-weight: 500;
  cursor: pointer;
  background-color: var(--sm-input-bg);
  transition: background-color var(--sm-transition-fast);

  &:hover {
    background-color: color-mix(in srgb, var(--sm-input-bg) 80%, var(--sm-border));
  }

  &:focus-visible {
    outline: none;
    box-shadow: inset 0 0 0 2px var(--sm-focus-ring);
  }
}

details[open] summary {
  border-bottom: 1px solid var(--sm-border);
}

details> :not(summary) {
  padding: var(--sm-space);
}

/* Progress */
progress {
  vertical-align: baseline;
  width: 100%;
  height: 0.75rem;
  border-radius: var(--sm-radius);
  overflow: hidden;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;

  &::-webkit-progress-bar {
    background-color: var(--sm-input-bg);
  }

  &::-webkit-progress-value {
    background-color: var(--sm-accent);
    transition: width var(--sm-transition);
  }

  &::-moz-progress-bar {
    background-color: var(--sm-accent);
    transition: width var(--sm-transition);
  }
}
}

/* ---- Composition Patterns Layer ---- */
@layer composition {
  /* ---- Layout Patterns ---- */

  /* Responsive Content Wrapper */
  .content-wrapper {
    width: min(100%, var(--sm-wide));
    margin-inline: auto;
    padding-inline: var(--sm-space);
  }

  /* Two Column Layout */
  .two-columns {
    display: grid;
    gap: var(--sm-space);

    @media (min-width: 768px) {
      grid-template-columns: 1fr 1fr;
    }
  }

  /* Three Column Layout */
  .three-columns {
    display: grid;
    gap: var(--sm-space);

    @media (min-width: 768px) {
      grid-template-columns: 1fr 1fr 1fr;
    }
  }

  /* Auto Grid */
  .auto-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 20rem), 1fr));
    gap: var(--sm-space);
  }

  /* Sidebar Layout */
  .with-sidebar {
    display: grid;
    gap: var(--sm-space);

    @media (min-width: 768px) {
      grid-template-columns: 3fr 1fr;
    }
  }

  /* ---- Component Patterns ---- */

  /* Card Pattern */
  .card {
    border: 1px solid var(--sm-border);
    border-radius: var(--sm-radius);
    overflow: hidden;
  }

  .card>header {
    padding: var(--sm-space);
    border-bottom: 1px solid var(--sm-border);
    background-color: var(--sm-input-bg);
  }

  .card>.content {
    padding: var(--sm-space);
  }

  .card>footer {
    padding: var(--sm-space);
    border-top: 1px solid var(--sm-border);
    background-color: var(--sm-input-bg);
  }

  /* Alert Pattern */
  .alert {
    position: relative;
    padding: var(--sm-space);
    margin-block-end: var(--sm-space);
    border: 1px solid var(--sm-border);
    border-radius: var(--sm-radius);
    display: flex;
    gap: var(--sm-space-sm);
  }

  /* Badge Pattern */
  .badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding-block: 0.25rem;
    padding-inline: 0.5rem;
    font-size: var(--sm-font-sm);
    font-weight: 600;
    line-height: 1;
    border-radius: var(--sm-radius-sm);
  }

  /* Button Variants */
  [role="button"],
  button[primary],
  input[type="submit"][primary],
  input[type="button"][primary] {
    color: white;
    background-color: var(--sm-accent);
    border-color: var(--sm-accent);

    &:hover {
      background-color: var(--sm-accent-subtle);
      border-color: var(--sm-accent-subtle);
    }
  }

  [role="button"][outline],
  button[outline],
  input[type="submit"][outline],
  input[type="button"][outline] {
    color: var(--sm-accent);
    border-color: var(--sm-accent);
    background-color: transparent;

    &:hover {
      color: white;
      background-color: var(--sm-accent);
    }
  }

  /* Breadcrumb Pattern */
  nav[aria-label="Breadcrumb"] ol {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  nav[aria-label="Breadcrumb"] li {
    display: flex;
    align-items: center;
  }

  nav[aria-label="Breadcrumb"] li:not(:last-child)::after {
    content: "/";
    margin-inline: 0.5rem;
    color: var(--sm-muted);
  }

  /* Color Indicators */
  [data-type="success"] {
    color: var(--sm-success);
    border-color: var(--sm-success);
    background-color: color-mix(in srgb, var(--sm-success) 10%, transparent);
  }

  [data-type="warning"] {
    color: var(--sm-warning);
    border-color: var(--sm-warning);
    background-color: color-mix(in srgb, var(--sm-warning) 10%, transparent);
  }

  [data-type="error"] {
    color: var(--sm-error);
    border-color: var(--sm-error);
    background-color: color-mix(in srgb, var(--sm-error) 10%, transparent);
  }

  /* Tooltip Pattern */
  [data-tooltip] {
    position: relative;

    &::before,
    &::after {
      position: absolute;
      opacity: 0;
      visibility: hidden;
      transition:
        opacity var(--sm-transition-fast),
        visibility var(--sm-transition-fast),
        transform var(--sm-transition-fast);
      pointer-events: none;
      z-index: 1;
    }

    /* Tooltip arrow */
    &::before {
      content: "";
      border: 5px solid transparent;
      border-top-color: var(--sm-fg);
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(10px);
    }

    /* Tooltip text */
    &::after {
      content: attr(data-tooltip);
      bottom: calc(100% + 5px);
      left: 50%;
      transform: translateX(-50%) translateY(10px);
      background-color: var(--sm-fg);
      color: var(--sm-bg);
      font-size: var(--sm-font-sm);
      padding-block: 0.25rem;
      padding-inline: 0.5rem;
      border-radius: var(--sm-radius-sm);
      white-space: nowrap;
      text-align: center;
      max-width: 200px;
    }

    &:hover::before,
    &:hover::after,
    &:focus::before,
    &:focus::after {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }
  }

  /* Typography Utilities */
  .text-xs {
    font-size: var(--sm-font-xs);
    line-height: var(--sm-line-height-xs);
  }

  .text-sm {
    font-size: var(--sm-font-sm);
    line-height: var(--sm-line-height-sm);
  }

  .text-base {
    font-size: var(--sm-font-base);
    line-height: var(--sm-line-height-base);
  }

  .text-md {
    font-size: var(--sm-font-md);
    line-height: var(--sm-line-height-md);
  }

  .text-lg {
    font-size: var(--sm-font-lg);
    line-height: var(--sm-line-height-lg);
  }

  .text-xl {
    font-size: var(--sm-font-xl);
    line-height: var(--sm-line-height-xl);
  }

  .text-2xl {
    font-size: var(--sm-font-2xl);
    line-height: var(--sm-line-height-2xl);
  }

  .text-3xl {
    font-size: var(--sm-font-3xl);
    line-height: var(--sm-line-height-3xl);
  }

  /* Text colors */
  .text-muted {
    color: var(--sm-subtle);
  }

  .text-accent {
    color: var(--sm-accent);
  }

  .text-success {
    color: var(--sm-success);
  }

  .text-warning {
    color: var(--sm-warning);
  }

  .text-error {
    color: var(--sm-error);
  }
}

/* ---- State Modifiers Layer ---- */
@layer states {
  /* ---- Interactive States ---- */

  /* Active/Current State */
  [aria-current="page"],
  [aria-current="step"],
  [aria-current="location"],
  [aria-current="date"],
  [aria-current="time"] {
    font-weight: 600;
    color: var(--sm-accent);
  }

  /* Selected State */
  [aria-selected="true"] {
    background-color: color-mix(in srgb, var(--sm-accent) 15%, transparent);
    border-color: var(--sm-accent);
  }

  /* Expanded State */
  [aria-expanded="true"] {
    background-color: var(--sm-input-bg);
  }

  /* Checked State */
  [aria-checked="true"],
  [checked] {
    background-color: var(--sm-accent);
    border-color: var(--sm-accent);
  }

  /* Disabled State */
  [aria-disabled="true"],
  [disabled] {
    opacity: 0.6;
    cursor: not-allowed;
    user-select: none;
    pointer-events: none;
  }

  /* Hidden Elements */
  [hidden],
  [aria-hidden="true"] {
    display: none !important;
  }

  /* Busy State */
  [aria-busy="true"] {
    cursor: progress;
    opacity: 0.7;
  }

  /* Draggable */
  [draggable="true"] {
    cursor: grab;
  }

  [draggable="true"]:active {
    cursor: grabbing;
  }

  /* Content States */
  .is-loading::after {
    content: "...";
    display: inline-block;
    animation: loading-dots 1.5s infinite;
  }

  @keyframes loading-dots {
    0% {
      content: "";
    }

    25% {
      content: ".";
    }

    50% {
      content: "..";
    }

    75% {
      content: "...";
    }
  }

  /* Invalid State */
  [aria-invalid="true"] {
    border-color: var(--sm-error);
  }

  /* Required State */
  [aria-required="true"]::after {
    content: " *";
    color: var(--sm-error);
  }

  /* JavaScript-less Navigation Toggle */
  .nav-toggle:focus~ul,
  .nav-toggle:focus~div {
    display: flex !important;
  }

  #nav-toggle:checked~ul,
  #nav-toggle:checked~div {
    display: flex !important;
  }

  #nav-toggle {
    position: absolute;
    top: -9999px;
    left: -9999px;
  }

  .nav-toggle[for="nav-toggle"] {
    cursor: pointer;
  }
}

/* ---- Media Queries Layer ---- */
@layer queries {
  /* ---- Responsive Adjustments ---- */

  /* Mobile-first adjustments */
  @media (max-width: 767px) {

    /* Stackable elements on small screens */
    table,
    th,
    td {
      display: block;
    }

    th {
      position: absolute;
      top: -9999px;
      left: -9999px;
    }

    td {
      position: relative;
      padding-left: 50%;
      text-align: left;
    }

    td::before {
      content: attr(data-label);
      position: absolute;
      left: 0.75rem;
      width: 45%;
      padding-right: 10px;
      white-space: nowrap;
      font-weight: 600;
    }

    /* Simplified navigation */
    nav {
      flex-direction: column;
      gap: var(--sm-space-xs);
    }
  }

  /* Medium screen adjustments */
  @media (min-width: 768px) {

    /* Two-column form layout */
    form:not([data-layout="stack"]) {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--sm-space);
    }

    form:not([data-layout="stack"])>fieldset,
    form:not([data-layout="stack"])>[data-span="full"] {
      grid-column: span 2;
    }
  }

  /* Large screen adjustments */
  @media (min-width: 1024px) {

    /* Expanded navigation */
    header nav {
      display: flex;
      flex-direction: row;
    }
  }

  /* Media Feature Queries */

  /* Reduced motion preference */
  @media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: more) {
    :root {
      --sm-focus-ring: rgba(0, 0, 0, 0.75);
      --sm-border: black;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --sm-focus-ring: rgba(255, 255, 255, 0.75);
        --sm-border: white;
      }
    }

    /* Increase contrast */
    a,
    button,
    [role="button"] {
      color: black;
      background-color: white;
      border: 1px solid black;
      text-decoration: underline;
    }

    @media (prefers-color-scheme: dark) {

      a,
      button,
      [role="button"] {
        color: white;
        background-color: black;
        border: 1px solid white;
      }
    }
  }

  /* Print styles */
  @media print {

    /* Hide non-essential elements */
    nav,
    button,
    [role="button"],
    [data-print="hide"],
    dialog {
      display: none !important;
    }

    /* Optimize text for print */
    body {
      font-size: 12pt;
      line-height: 1.4;
      color: black;
      background-color: white;
    }

    /* Remove backgrounds and borders */
    * {
      background-color: transparent !important;
      box-shadow: none !important;
      color: black !important;
    }

    a {
      text-decoration: underline;
    }

    /* Show URLs for links */
    a[href^="http"]::after {
      content: " (" attr(href) ")";
      font-size: 90%;
      font-style: italic;
    }

    /* Page breaks */
    h1,
    h2,
    h3,
    h4,
    img,
    table {
      page-break-after: avoid;
      page-break-inside: avoid;
    }

    p,
    li {
      page-break-inside: avoid;
    }

    /* Page margin */
    @page {
      margin: 2cm;
    }
  }

  /* Container Queries */
  @supports (container-type: inline-size) {

    /* Container setup */
    .container {
      container-type: inline-size;
      container-name: layout;
    }

    /* Adjust card layouts based on container width */
    @container layout (min-width: 40rem) {
      .card {
        display: grid;
        grid-template-columns: 1fr 2fr;
      }

      .card>header {
        grid-column: 1;
        border-right: 1px solid var(--sm-border);
        border-bottom: none;
      }

      .card>.content {
        grid-column: 2;
        grid-row: 1 / span 2;
      }

      .card>footer {
        grid-column: 1;
        grid-row: 2;
        border-right: 1px solid var(--sm-border);
        border-top: none;
      }
    }
  }
}

/* ---- Utility Functions ---- */

/* Modern Color Function Fallbacks */
@supports not (color-mix(in srgb, var(--sm-accent) 10%, transparent)) {
  [data-type="success"] {
    background-color: rgba(16, 185, 129, 0.1);
  }

  [data-type="warning"] {
    background-color: rgba(245, 158, 11, 0.1);
  }

  [data-type="error"] {
    background-color: rgba(239, 68, 68, 0.1);
  }
}

/* Select-Based Dark Mode Toggle */
#theme-toggle {
  appearance: none;
  -webkit-appearance: none;
  position: fixed;
  bottom: 1rem;
  right: 1rem;
  z-index: 100;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background-color: var(--sm-accent);
  color: white;
  font-size: 0;
  cursor: pointer;
  border: none;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--sm-shadow-md);
}

/* Dark Mode Icon */
#theme-toggle::before {
  content: "";
  display: block;
  width: 24px;
  height: 24px;
  background-color: transparent;
  border-radius: 50%;
  box-shadow: inset 8px -8px 0 0 white;
  transform: rotate(45deg);
  transition: box-shadow var(--sm-transition-fast);
}

/* Light Mode Icon */
#theme-toggle:checked::before {
  box-shadow: inset 12px -12px 0 0 white;
  transform: rotate(90deg);
}

/* Theme Toggle Integration */
#theme-toggle:checked~* {
  --sm-bg: var(--sm-color-gray-800);
  --sm-fg: var(--sm-color-gray-50);
  --sm-subtle: var(--sm-color-gray-400);
  --sm-border: var(--sm-color-gray-700);
  --sm-input-bg: var(--sm-color-gray-900);
  --sm-focus-ring: color-mix(in srgb, var(--sm-accent) 60%, transparent);
}

/* JavaScript-less Disclosure Widget */
.disclosure-btn {
  cursor: pointer;
}

.disclosure-btn+.disclosure-content {
  display: none;
}

.disclosure-btn:focus+.disclosure-content,
.disclosure-btn:active+.disclosure-content {
  display: block;
}

/* JavaScript-less Tabs */
.tabs {
  display: flex;
}

.tab-btn {
  padding: 0.5rem 1rem;
  border-bottom: 2px solid transparent;
  cursor: pointer;
}

.tab-btn:focus {
  border-bottom-color: var(--sm-accent);
}

.tab-panel {
  display: none;
}

.tab-btn:focus+.tab-panel,
.tab-btn:target+.tab-panel {
  display: block;
}

/* JavaScript-less Modal via :target Selector */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
}

.modal:target {
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background-color: var(--sm-bg);
  padding: var(--sm-space);
  border-radius: var(--sm-radius);
  max-width: 90%;
  max-height: 90%;
  overflow: auto;
}

/* Accessible Skip Link */
.skip-link {
  position: absolute;
  top: -100px;
  left: 0;
  background-color: var(--sm-accent);
  color: white;
  padding: 10px;
  z-index: 9999;
}

.skip-link:focus {
  top: 0;
}

/* Visually Hidden Yet Accessible Text */
.visually-hidden {
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  height: 1px;
  overflow: hidden;
  position: absolute;
  white-space: nowrap;
  width: 1px;
}

/* Smart Table Layout */
@supports (width: min-content) {
  table {
    width: auto;
    max-width: 100%;
  }

  th {
    white-space: nowrap;
    width: min-content;
  }
}

/* Enhanced Focus Styles */
:focus-visible {
  outline: 2px solid var(--sm-focus-ring);
  outline-offset: 2px;
  z-index: 1;
}

/* Supports Modern Attribute Selectors */
@supports selector(:has(*)) {
  label:has(input:required)::after {
    content: " *";
    color: var(--sm-error);
  }
}